<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إلى نور | To Nour</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050505; /* لون احتياطي */
            font-family: 'Tajawal', sans-serif;
        }

        canvas {
            display: block;
        }

        /* تنسيق التوقيع ليكون فوق الكانفس */
        .signature {
            position: absolute;
            bottom: 15px;
            left: 20px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 14px;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>

    <div class="signature">من إعداد قيس جازي</div>
    <canvas id="scene"></canvas>

    <script>
        const canvas = document.getElementById('scene');
        const ctx = canvas.getContext('2d');

        // متغيرات الأبعاد
        let width, height;

        // ضبط حجم الكانفس
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- حالة المشهد ---
        const state = {
            phase: 'walking', // walking, standing, talking
            timer: 0,
            textAlpha: 0,
            subTextAlpha: 0
        };

        // --- النجوم ---
        const stars = [];
        const numStars = 150;

        for (let i = 0; i < numStars; i++) {
            stars.push({
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight * 0.8,
                radius: Math.random() * 1.5,
                alpha: Math.random(),
                twinkleSpeed: 0.02 + Math.random() * 0.05
            });
        }

        // --- الشهب (Shooting Stars) ---
        let shootingStar = null;

        function createShootingStar() {
            shootingStar = {
                x: Math.random() * width,
                y: Math.random() * height * 0.3,
                length: 0,
                speed: 15,
                angle: Math.PI / 4 // 45 درجة
            };
        }

        // --- الرجل (The Walker) ---
        const man = {
            x: -50, // يبدأ من اليسار خارج الشاشة
            y: 0,   // سيتم تحديده بناءً على الأرضية
            speed: 2,
            scale: 0.8,
            legAngle: 0,
            armAngle: 0,
            color: '#000' // Silhouette
        };

        // --- النصوص ---
        const messages = {
            title: "إلى أميرتي نور..",
            body: ["أنتِ القمر الذي يضيء عتمة الليالي.", "دمتِ فخراً، وجمالاً، وقلباً نقياً.", "أحبك يا ابنتي."]
        };
        let typedText = "";
        let typeIndex = 0;
        let lineIndex = 0;
        let lastTypeTime = 0;


        // ==========================================
        // حلقة الرسم الرئيسية (The Loop)
        // ==========================================
        function animate() {
            ctx.clearRect(0, 0, width, height);

            // 1. رسم السماء (Gradient Background)
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#020b1a'); // كحلي غامق جداً
            gradient.addColorStop(1, '#1b3a5f'); // أزرق ليلي
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // 2. رسم القمر
            drawMoon();

            // 3. رسم النجوم
            drawStars();

            // 4. رسم الأرضية (Tierra)
            const groundHeight = height * 0.2;
            const groundY = height - groundHeight;
            man.y = groundY + 10; // ضبط موقع الرجل على الأرض

            ctx.fillStyle = '#0a0a0a';
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            // رسم تضاريس بسيطة
            ctx.bezierCurveTo(width / 3, groundY - 20, width * 2 / 3, groundY + 20, width, groundY);
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.fill();

            // 5. منطق الحركة (Logic)
            updateMan();

            // 6. رسم الرجل
            drawMan(man.x, man.y, man.scale, state.phase === 'walking');

            // 7. رسم النصوص
            if (state.phase === 'talking') {
                drawText();
            }

            requestAnimationFrame(animate);
        }

        // --- دوال الرسم المساعدة ---

        function drawMoon() {
            const moonX = width * 0.7; // القمر على اليمين قليلاً
            const moonY = height * 0.2;
            const moonRadius = 60;

            // توهج القمر
            ctx.shadowBlur = 50;
            ctx.shadowColor = "rgba(255, 255, 255, 0.8)";
            
            ctx.beginPath();
            ctx.arc(moonX, moonY, moonRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#fefefe';
            ctx.fill();
            
            ctx.shadowBlur = 0; // إعادة تعيين الظل

            // تفاصيل خفيفة للقمر (Craters)
            ctx.globalAlpha = 0.1;
            ctx.fillStyle = '#ccc';
            ctx.beginPath();
            ctx.arc(moonX - 15, moonY + 10, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(moonX + 20, moonY - 15, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }

        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                // تأثير اللمعان
                star.alpha += star.twinkleSpeed;
                if (star.alpha > 1 || star.alpha < 0.2) star.twinkleSpeed *= -1;
                
                ctx.globalAlpha = Math.abs(star.alpha);
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1.0;

            // منطق الشهب
            if (!shootingStar && Math.random() < 0.005) {
                createShootingStar();
            }

            if (shootingStar) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(shootingStar.x, shootingStar.y);
                ctx.lineTo(shootingStar.x - shootingStar.length, shootingStar.y - shootingStar.length);
                ctx.stroke();

                shootingStar.x += shootingStar.speed;
                shootingStar.y += shootingStar.speed;
                shootingStar.length += 1;

                if (shootingStar.x > width || shootingStar.y > height) {
                    shootingStar = null;
                }
            }
        }

        function updateMan() {
            if (state.phase === 'walking') {
                man.x += man.speed;
                // حركة الأرجل (Sine Wave)
                man.legAngle = Math.sin(Date.now() / 150) * 0.8;
                man.armAngle = Math.sin(Date.now() / 150) * 0.8;

                // التوقف عند المنتصف
                if (man.x >= width / 2 - 20) {
                    state.phase = 'standing';
                    man.legAngle = 0;
                    man.armAngle = 0;
                }
            } else if (state.phase === 'standing') {
                state.timer++;
                // انتظار قليلاً قبل الكلام
                if (state.timer > 60) { // حوالي ثانية
                    state.phase = 'talking';
                }
            }
        }

        function drawMan(x, y, s, isWalking) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(s, s);
            ctx.strokeStyle = 'black';
            ctx.fillStyle = 'black';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // 1. الأرجل
            // الرجل الخلفية
            ctx.beginPath();
            ctx.moveTo(0, -60);
            if(isWalking) {
                ctx.lineTo(Math.sin(man.legAngle) * 20, -30);
                ctx.lineTo(Math.sin(man.legAngle) * 30, 0); 
            } else {
                ctx.lineTo(-10, 0);
            }
            ctx.stroke();

            // الرجل الأمامية
            ctx.beginPath();
            ctx.moveTo(0, -60);
            if(isWalking) {
                ctx.lineTo(Math.sin(-man.legAngle) * 20, -30);
                ctx.lineTo(Math.sin(-man.legAngle) * 30, 0);
            } else {
                ctx.lineTo(10, 0);
            }
            ctx.stroke();

            // 2. الجذع (Body)
            ctx.beginPath();
            ctx.moveTo(0, -60);
            ctx.lineTo(0, -110);
            ctx.stroke();

            // 3. الأذرع
            ctx.beginPath();
            ctx.moveTo(0, -100);
            if(isWalking) {
                ctx.lineTo(Math.sin(-man.armAngle) * 20, -70);
            } else {
                // وضعية النظر للقمر (يد مرفوعة قليلاً أو جانبية)
                if (state.phase !== 'walking') {
                     ctx.lineTo(10, -80); // يد مسترخية
                } else {
                    ctx.lineTo(0, -70);
                }
            }
            ctx.stroke();

            // 4. الرأس
            ctx.beginPath();
            // تحريك الرأس قليلاً للأعلى عند الوقوف للنظر للقمر
            let headLook = (state.phase !== 'walking') ? -5 : 0;
            ctx.arc(5, -125 + headLook, 12, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawText() {
            const centerX = width / 2;
            const centerY = height * 0.4;

            ctx.textAlign = "center";
            ctx.fillStyle = "white";

            // العنوان الرئيسي
            ctx.font = "bold 40px 'Tajawal'";
            // تأثير الظهور التدريجي
            if(state.textAlpha < 1) state.textAlpha += 0.01;
            ctx.globalAlpha = state.textAlpha;
            ctx.fillText(messages.title, centerX, centerY);

            // النص الفرعي (Typewriter)
            ctx.font = "300 24px 'Tajawal'";
            ctx.globalAlpha = 1; // النص الفرعي يتحكم بظهوره الـ Typewriter
            
            // التأكد من اكتمال ظهور العنوان قبل البدء بالكتابة
            if(state.textAlpha >= 0.8) {
                if(Date.now() - lastTypeTime > 80 && lineIndex < messages.body.length) {
                    let currentLine = messages.body[lineIndex];
                    if(typeIndex < currentLine.length) {
                        typedText += currentLine[typeIndex];
                        typeIndex++;
                        lastTypeTime = Date.now();
                    } else {
                        // الانتقال للسطر التالي بعد فترة
                         if(Date.now() - lastTypeTime > 1500) { // انتظار أطول بين الجمل
                             typedText = "";
                             typeIndex = 0;
                             lineIndex++;
                             // إذا انتهت الجمل، يمكن إعادة التدوير أو التوقف. هنا سيتوقف عند آخر جملة.
                             if(lineIndex >= messages.body.length) {
                                 lineIndex = messages.body.length -1; 
                                 typedText = messages.body[lineIndex]; // إبقاء آخر جملة
                             }
                         }
                    }
                }
                
                // رسم النص المكتوب حالياً
                ctx.fillStyle = "#ddd";
                ctx.fillText(typedText, centerX, centerY + 60);
            }
            
            ctx.globalAlpha = 1;
        }

        // بدء التشغيل
        animate();

    </script>
</body>
</html>

